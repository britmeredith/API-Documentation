openapi: 3.0.3
info:
  title: Content Sentiment Analyzer API
  description: |
    An API for analyzing the sentiment (specifically, the "toxicity") of text content. 
    This documentation provides interactive examples for all endpoints, including single-analysis, batch processing, and asynchronous job handling.
  version: 1.0.0
  contact:
    name: API Support
    url: https://www.example.com/support
    email: support@example.com
servers:
  - url: https://api.example.com/v1
    description: Production Server
paths:
  /analyze:
    post:
      summary: Analyze a single text input
      description: Submits a single string for sentiment analysis and returns the results directly.
      operationId: analyzeSingleText
      requestBody:
        description: The text content to be analyzed.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnalysisRequest'
      responses:
        '200':
          description: Analysis successful.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalysisResponse'
        '400':
          description: Bad request, such as invalid input.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /analyze/batch:
    post:
      summary: Analyze a batch of text inputs
      description: |
        Submits a batch of up to 50 text strings for analysis. 
        For larger workloads, this endpoint may return a job ID for asynchronous processing.
      operationId: analyzeBatchText
      requestBody:
        description: An array of text strings to analyze.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BatchAnalysisRequest'
      responses:
        '200':
          description: Batch analysis completed synchronously.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchAnalysisResponse'
        '202':
          description: |
            Batch analysis accepted for asynchronous processing. 
            The response body contains a `jobId` that you can use to poll the `/status/{jobId}` endpoint.
          content:
            application/json:
              schema:
                type: object
                properties:
                  jobId:
                    type: string
                    example: "job-12345-abcdef"
          headers:
            Location:
              description: The URL to poll for the job status.
              schema:
                type: string
                example: "/status/job-12345-abcdef"
        '400':
          description: Bad request.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /status/{jobId}:
    get:
      summary: Get asynchronous job status
      description: Poll this endpoint to check the status of a batch analysis job.
      operationId: getJobStatus
      parameters:
        - name: jobId
          in: path
          required: true
          description: The ID of the job to check.
          schema:
            type: string
      responses:
        '200':
          description: Job is complete. The results are included in the response.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobStatus'
          links:
            GetResultsByJobId:
              operationId: getJobStatus
              parameters:
                jobId: '$response.body#/jobId'
              description: 'The `jobId` from the response can be used to poll for status.'
        '202':
          description: Job is still in progress.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobStatus'
        '404':
          description: Job not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
components:
  schemas:
    AnalysisRequest:
      type: object
      properties:
        text:
          type: string
          description: The text to be analyzed.
          example: "I love sunny days!"
      required:
        - text
    AnalysisResponse:
      type: object
      properties:
        id:
          type: string
          example: "analysis-abc-123"
        text:
          type: string
          example: "I love sunny days!"
        toxicityScore:
          type: number
          format: float
          description: A score between 0 and 1, where 1 is highly toxic.
          example: 0.05
    BatchAnalysisRequest:
      type: object
      properties:
        texts:
          type: array
          items:
            type: string
          maxItems: 50
          minItems: 1
          example: ["This is great!", "This is terrible."]
      required:
        - texts
    BatchAnalysisResponse:
      type: array
      items:
        $ref: '#/components/schemas/AnalysisResponse'
    JobStatus:
      type: object
      properties:
        jobId:
          type: string
          example: "job-12345-abcdef"
        status:
          type: string
          enum: [pending, in_progress, completed, failed]
          example: "in_progress"
        results:
          type: array
          items:
            $ref: '#/components/schemas/AnalysisResponse'
          description: "Results are included when the status is 'completed'."
      required:
        - jobId
        - status
    Error:
      type: object
      properties:
        code:
          type: integer
          format: int32
        message:
          type: string
      required:
        - code
        - message
  securitySchemes:
    oAuth2:
      type: oauth2
      description: This API uses OAuth2 with the clientCredentials grant type.
      flows:
        clientCredentials:
          tokenUrl: https://api.example.com/oauth/token
          scopes:
            read:analyses: Read analysis results
            write:analyses: Submit new analyses
security:
  - oAuth2: [read:analyses, write:analyses]